{
  "kind": "build_request",
  "title": "Fix blank-screen on /operations/user-management with loading state and timeout failsafe",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "In `frontend/src/pages/Operations/UserManagement.tsx`, remove all `return null` and blank/early returns that occur while `roleLoading` or `backendLoading` are true. Instead, render a visible centered loading state that keeps the page layout and nav visible, displaying the title 'User Management' and the message 'Loading permissions & users...' with an optional small spinner.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "Fix the blank-screen issue by removing ANY `return null` (or blank return) during roleLoading/backendLoading.",
          "While loading, render a visible centered loading state (keep the page layout + nav visible)"
        ]
      },
      "acceptanceCriteria": [
        "No `return null` or empty returns exist in the component while roleLoading or backendLoading are true",
        "During loading, the page layout and nav remain visible",
        "A centered loading state is shown with the title 'User Management' and message 'Loading permissions & users...' along with a spinner"
      ]
    },
    {
      "id": "REQ-2",
      "text": "In `frontend/src/pages/Operations/UserManagement.tsx`, add an 8-second hard timeout failsafe: start a timer when loading begins; if `roleLoading` or `backendLoading` is still true after 8000ms, forcibly set both to false and display a visible error box with the message: 'Still loading role/backend after 8s. Please refresh.' and include debug output showing the current boolean values of `roleLoading` and `backendLoading`.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "Add a hard timeout failsafe",
          "Start a timer when loading begins (e.g. 8000ms)",
          "If still loading after timeout, set loading false and show a visible error box: 'Still loading role/backend after 8s. Please refresh. (debug: show roleLoading/backendLoading booleans)'"
        ]
      },
      "acceptanceCriteria": [
        "A timeout of 8000ms is started when the component mounts or loading begins",
        "If loading is still true after 8 seconds, both roleLoading and backendLoading are set to false",
        "A visible error box is rendered with the text 'Still loading role/backend after 8s. Please refresh.'",
        "The error box includes debug output showing the boolean values of roleLoading and backendLoading at timeout time",
        "The timeout is cleared if loading completes before 8 seconds"
      ]
    },
    {
      "id": "REQ-3",
      "text": "In `frontend/src/pages/Operations/UserManagement.tsx`, wrap every async load path in a `try/finally` block to guarantee that `setRoleLoading(false)` and `setBackendLoading(false)` are always called in the `finally` clause, preventing the loading state from getting stuck indefinitely regardless of success or error.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "Ensure every async load path ends with `setRoleLoading(false)` / `setBackendLoading(false)` in a `finally {}` block so loading cannot get stuck forever."
        ]
      },
      "acceptanceCriteria": [
        "Every async function or effect that sets roleLoading or backendLoading to true wraps its logic in try/finally",
        "The finally block always calls setRoleLoading(false) and/or setBackendLoading(false) as appropriate",
        "If an async call throws an error, loading state is still reset to false"
      ]
    }
  ],
  "constraints": [
    "Do not change the backend (backend/main.mo)",
    "Do not change any routes",
    "Do not change the nav or AppLayout",
    "Changes are limited exclusively to frontend/src/pages/Operations/UserManagement.tsx"
  ],
  "nonGoals": [
    "Modifying any other page or component besides UserManagement.tsx",
    "Changing backend data models or canister logic",
    "Changing routing configuration",
    "Changing navigation components"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}